---
title: "Bookdown"
output:
  html_document:
    df_print: paged
---
# Bookdown
你是否会遇到以上问题，写一种书的源文件，可以转化为多种格式。传统的方法是用 *Latex* 或者 *word*。使用 *word* 就会一直停留在 *word* ，无法体会到 *Latex* 的好处。而使用 *Latex* 的话， 经常就只能用 *PDF* 格式了。*Bookdown* 可以满足你的需求。

## 要求
安装 *R* 和 *bookdown* 包

# 介绍
*Bookdown* 解决以下问题：

* 如何对公式，理论，图表和交叉引用进行排版
* 如何产生多种输出格式
* 如何一般化书的模板
* 编译器支持
* 如何出版书

## 动机
使书更加容易阅读，一些写书的框架也不错，例如 [Gitbook](https://www.gitbook.com)，[Tufte CSS](http://edwardtufte.github.io/tufte-css/),[Tufte-LaTeX](https://tufte-latex.github.io/tufte-latex/))

## 开始
最简单的方式就是从一个[demo](https://github.com/rstudio/bookdown-demo)开始，通过以下步骤：

* 下载这个[demo](https://github.com/rstudio/bookdown-demo)
* 安装 *Rstudio*
* 安装 *bookdown*
* 打开demo的文件夹，点击 `bookdown-demo.Rproj`的文件
* 打开 `index.Rmd` 文件，点击 `Build book`

## 使用方法
在demo例子中，我们有这些文件：

* index.Rmd
* 01-intro.Rmd
* 02-literature.Rmd
* 03-method.Rmd
* 04-application.Rmd
* 05-summary.Rmd

*bookdown* 将这些 *Rmd* 文件按照文件顺序进行融合，例如 *01-intro.Rmd* 和 *02-literature.Rmd*, 文件带有下划线 `_` 将被忽略，如果有 `index.Rmd` 文件，则 `index.html`将从这个文件产生。也可以通过 `_bookdown.yml`文件进行配置，可以通过`rmd_files`来实现配置：

```
rmd_files: ["index.Rmd", "abstract.Rmd", "intro.Rmd"]
```

加入你需要多种输出结果，可以使用下面的命令：

```
rmd_files:
  html: ["index.Rmd", "abstract.Rmd", "intro.Rmd"]
  latex: ["abstract.Rmd", "intro.Rmd"]
```

可以选择多种输出格式：

```
bookdown::render_book("foo.Rmd", "bookdown::gitbook")
bookdown::render_book("foo.Rmd", "bookdown::pdf_book")
bookdown::render_book("foo.Rmd", bookdown::gitbook(lib_dir = "libs"))
bookdown::render_book("foo.Rmd", bookdown::pdf_book(keep_tex = TRUE))
```

可以定义一个`YAML field`叫做`site`，并赋值 `bookdown::bookdown_site`，输出格式在 `output` 定义：
```
---
site: "bookdown::bookdown_site"
output:
  bookdown::gitbook:
    lib_dir: "book_assets"
  bookdown::pdf_book:
    keep_tex: yes
---
```

可以使用`Build book`和`Knit`按钮来编译当前章节。

更多关于`_bookdown.yml`在后面介绍，这里只是一个简单的例子

```
--- 
title: "Authoring A Book with R Markdown"
author: "Yihui Xie"
date: "`r Sys.Date()`"
site: "bookdown::bookdown_site"
output:
  bookdown::gitbook: default
documentclass: book
bibliography: ["book.bib", "packages.bib"]
biblio-style: apalike
link-citations: yes
---
```

## 两种编译方法
对于编译，有两种方式。第一种是`Merge and Knit`(M-K)，即先合并再转化，另外一种是`Knit and Merge`(K-M)，即先转化在合并。一般来说，编译默认的方式是M-K，如果需要转化为K-M，使用`render_book()`函数时使用`new_session = TRUE`，或者在`_bookdown.ylm`文件中加入 `new_session: yes`

## 一些小的建议
* 编译成*PDF*文件比较耗时，所以建议先编译成为`HTML`格式，版本确定之后，再转化成为*PDF*
* 因为编译时候，有程序运行，所以建议加上`cache = TRUE`：
```
\```{r important-computing, cache=TRUE}
```

# 组成 
这一章主要介绍`Pandoc`的一些使用，就是`Markdown`的内容

* _text_：`_text_` 或者 `*text*`
* __text__: `__text__` 或者 `**text**`
* H~2~SO~4~: `H~2~SO~4~`
* Fe^2+^: `Fe^2+^`
* <span style="font-variant:small-caps;">Small Caps</span>: `<span style="font-variant:small-caps;">Small Caps</span>`
* 插入图片：`![alt text or image title](path/to/image)`
* 脚注：`^[This is a footnote.]`

## 公式
```
\begin{equation} 
  f\left(k\right) = \binom{n}{k} p^k\left(1-p\right)^{n-k}
  (\#eq:binom)
\end{equation} 
```
公式如下：
\begin{equation} 
  f\left(k\right) = \binom{n}{k} p^k\left(1-p\right)^{n-k}
  (\#eq:binom)
\end{equation} 

如果要引用公式 `\@ref(eq:binom)`

## 理论和证明
由于这部分文件比较特殊，可以看[这里](https://bookdown.org/yihui/bookdown/markdown-extensions-by-bookdown.html)
```{theorem}
Here is my theorem.
```

```{theorem, pyth, name="Pythagorean theorem"}
For a right triangle, if $c$ denotes the length of the hypotenuse
and $a$ and $b$ denote the lengths of the other two sides, we have

$$a^2 + b^2 = c^2$$
```

## 图

```{r, warning=FALSE,cache=TRUE}
par(mar = c(4, 4, 0.1, 0.1))
plot(pressure, pch = 19, type = "b")
```

## 表
```{r}
knitr::kable(
  head(mtcars[, 1:8], 10), booktabs = TRUE,
  caption = 'A table of the first 10 rows of the mtcars data.'
)
```

### 多张表
```{r}
knitr::kable(
  list(
    head(iris[, 1:2], 3),
    head(mtcars[, 1:3], 5)
  ),
  caption = 'A Tale of Two Tables.', booktabs = TRUE
)
```

### 长表
如果是比较长的表，需要进行分页，需要用到`longtable = TRUE`，并且使用`\usepackage{longtable}`在 _LaTeX_ preamble 文件中
```{r}
knitr::kable(
  iris[1:55, ], longtable = TRUE, booktabs = TRUE,
  caption = 'A table generated by the longtable package.'
)
```

## 交叉引用
使用命令`\@ref(label)`，*Pandoc* 将会对标题产生一个ID，例如 `# Hello World`，可以使用ID `hello-world`

## 区块
使用`{block}`来实现
```{block}
<div class="FOO">
Some text for this block.
</div>
```

## 引用
可以将引用写入`.bib`文件，使用BibTex, BibTex文件如下：
```
@Manual{R-base,
  title = {R: A Language and Environment for Statistical
    Computing},
  author = {{R Core Team}},
  organization = {R Foundation for Statistical Computing},
  address = {Vienna, Austria},
  year = {2016},
  url = {https://www.R-project.org/},
}
```

引用方式：@key (\citet{key} in  Latex) 或 [@key] (\citep{key})

## HTML插件
R语言长处在于它的可视化，通过` htmlwidgets`的包可以使用一些Javascript插件，由于PDF格式不支持JS插件，所以需要使用一个包 *webshot* 来将JS截成一张静态图片，这个包是基于 *Phantomjs*的
```
install.packages("webshot")
webshot::install_phantomjs()
```
## 网页和Shiny
对于网页的嵌入，可以使用 `knitr::include_url()`进行嵌入；对于ShinyAPP可以使用 `knitr::include_app()`

# 输出格式
输出格式有三种：

* HTML(Gitbook, Bootstrap, Tufte)
* Latex/PDF
* E-books (EPUB, MOBI)


输出格式可以在第一个`.Rmd`文件YAML中申明，或者是在`_output.yml`文件中。
在`.Rmd`文件中申明：
```
---
title: "An Impressive Book"
author: "Li Lei and Han Meimei"
output:
  bookdown::gitbook:
    lib_dir: assets
    split_by: section
    config:
      toolbar:
        position: static
  bookdown::pdf_book:
    keep_tex: yes
  bookdown::html_book:
    css: toc.css
documentclass: book
---
```

`_output.yml`文件中申明：
```
bookdown::gitbook:
  lib_dir: assets
  split_by: section
  config:
    toolbar:
      position: static
bookdown::pdf_book:
  keep_tex: yes
bookdown::html_book:
  css: toc.css
```


